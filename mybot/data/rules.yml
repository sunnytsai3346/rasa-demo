version: "3.1"

rules:

# This rule ensures the bot always responds to a greeting.
- rule: Greet user
  steps:
    - intent: greet
    - action: utter_greet

# This rule handles simple goodbyes.
- rule: Say goodbye anytime the user says goodbye
  steps:
    - intent: goodbye
    - action: utter_goodbye

# This rule allows the bot to identify itself when asked.
- rule: Say 'I am a bot' anytime the user challenges
  steps:
    - intent: bot_challenge
    - action: utter_iamabot

# This rule defines a multi-step interaction for handling manual queries.
# It first queries the documentation and then presents the answer with an introduction.
- rule: Handle manual query
  steps:
    - intent: query_manual
    - action: action_query_knowledge_base
    - action: action_answer_with_intro

# This rule triggers a fallback action using a Large Language Model (LLM)
# when the NLU model is unable to confidently classify the user's intent.
- rule: Use LLM fallback on NLU fallback
  steps:
    - intent: nlu_fallback
    - action: action_llm_fallback

# This rule is for handling knowledge base queries.
# It first calls the knowledge base action and then provides the answer with an introduction.
- rule: Handle knowledge base query
  steps:
    - intent: query_knowledge_base
    - action: action_query_knowledge_base
    - action: action_answer_with_intro

- rule: Set command
  steps:
    - intent: set_command
    - action: action_set_command

- rule: Fallback to LLM when RAG score is low
  condition:
    - slot_was_set:
        - rag_score_is_low: true
  steps:
    - action: action_llm_fallback